<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>Call command through sshj | My Blog</title>
  <meta name="author" content="Forrest Wan">
  
  <meta name="description" content="My Blog">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Call command through sshj"/>
  <meta property="og:site_name" content="My Blog"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="shortcut icon" href="/favicon.png">
  
  
<link rel="stylesheet" href="/css/style.css">

  <!--[if lt IE 9]><script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script><![endif]-->
  

<meta name="generator" content="Hexo 6.1.0"></head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">My Blog</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/null">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article id="post-Call-command-through-sshj" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2012-07-10T06:48:21.000Z"><a href="/2012/07/10/Call-command-through-sshj/">2012-07-10</a></time>
      
      
  
    <h1 class="p-name title" itemprop="headline name">Call command through sshj</h1>
  

    </header>
    <div class="e-content entry" itemprop="articleBody">
      
        <h3 id="create-a-maven-project-mvn-archetype-generate"><a href="#create-a-maven-project-mvn-archetype-generate" class="headerlink" title="create a maven project mvn archetype:generate"></a>create a maven project <code>mvn archetype:generate</code></h3><h3 id="copy-sshj’s-dependency-to-pom-xml"><a href="#copy-sshj’s-dependency-to-pom-xml" class="headerlink" title="copy sshj’s dependency to pom.xml"></a>copy sshj’s dependency to pom.xml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;dh&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;ssh-remote&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;</span><br><span class="line">  &lt;packaging&gt;jar&lt;/packaging&gt;</span><br><span class="line"></span><br><span class="line">  &lt;name&gt;ssh-remote&lt;/name&gt;</span><br><span class="line">  &lt;url&gt;http://maven.apache.org&lt;/url&gt;</span><br><span class="line"></span><br><span class="line">  &lt;properties&gt;</span><br><span class="line">    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">  &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;junit&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;junit&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;3.8.1&lt;/version&gt;</span><br><span class="line">      &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;net.schmizz&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;sshj&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.8.0&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.slf4j&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.6.1&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;logback-core&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.9.29&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.9.29&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">  &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line"> &lt;plugins&gt;</span><br><span class="line">  &lt;plugin&gt;</span><br><span class="line">   &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;</span><br><span class="line">   &lt;artifactId&gt;exec-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">   &lt;version&gt;1.1.1&lt;/version&gt;</span><br><span class="line">   &lt;executions&gt;</span><br><span class="line">    &lt;execution&gt;</span><br><span class="line">     &lt;phase&gt;test&lt;/phase&gt;</span><br><span class="line">     &lt;goals&gt;</span><br><span class="line">      &lt;goal&gt;java&lt;/goal&gt;</span><br><span class="line">     &lt;/goals&gt;</span><br><span class="line">     &lt;configuration&gt;</span><br><span class="line">      &lt;mainClass&gt;dh.App&lt;/mainClass&gt;</span><br><span class="line">      &lt;arguments&gt;</span><br><span class="line">       &lt;argument&gt;arg0&lt;/argument&gt;</span><br><span class="line">       &lt;argument&gt;arg1&lt;/argument&gt;</span><br><span class="line">      &lt;/arguments&gt;</span><br><span class="line">     &lt;/configuration&gt;</span><br><span class="line">    &lt;/execution&gt;</span><br><span class="line">   &lt;/executions&gt;</span><br><span class="line">  &lt;/plugin&gt;</span><br><span class="line"> &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>

<h3 id="create-logback-xml"><a href="#create-logback-xml" class="headerlink" title="create logback.xml"></a>create logback.xml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">  &lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">    &lt;!-- encoders are assigned the type</span><br><span class="line">         ch.qos.logback.classic.encoder.PatternLayoutEncoder by default --&gt;</span><br><span class="line">    &lt;encoder&gt;</span><br><span class="line">      &lt;pattern&gt;%d&#123;HH:mm&#125; [%thread] %-5level %logger&#123;36&#125; - %msg%n&lt;/pattern&gt;</span><br><span class="line">    &lt;/encoder&gt;</span><br><span class="line">  &lt;/appender&gt;</span><br><span class="line"></span><br><span class="line">  &lt;!-- appender name=&quot;STDOUT&quot;</span><br><span class="line">			class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;</span><br><span class="line">		&lt;layout class=&quot;ch.qos.logback.classic.PatternLayout&quot;&gt;</span><br><span class="line">			&lt;pattern&gt;%-4relative [%thread] %-5level %class - %msg%n&lt;/pattern&gt;</span><br><span class="line">		&lt;/layout&gt;</span><br><span class="line">	&lt;/appender --&gt;</span><br><span class="line"></span><br><span class="line">  &lt;root level=&quot;off&quot;&gt;</span><br><span class="line">    &lt;appender-ref ref=&quot;STDOUT&quot; /&gt;</span><br><span class="line">  &lt;/root&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h3 id="coding-App-java"><a href="#coding-App-java" class="headerlink" title="coding App.java"></a>coding App.java</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">package dh;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">import net.schmizz.sshj.SSHClient;</span><br><span class="line">import net.schmizz.sshj.common.IOUtils;</span><br><span class="line">import net.schmizz.sshj.connection.channel.direct.Session;</span><br><span class="line">import net.schmizz.sshj.connection.channel.direct.Session.Command;</span><br><span class="line"></span><br><span class="line">public class App &#123;</span><br><span class="line">  private static final String df_command = &quot;df -g|head -3|tail -2&quot;;</span><br><span class="line">  private static final String recon_command = &quot;/tmp/xx/pps-recon.sh&quot;;</span><br><span class="line">  private static final String user = &quot;root&quot;;</span><br><span class="line">  private static final String passwd = &quot;pass3822&quot;;</span><br><span class="line">  private static final String wap01fingerprint = &quot;5a:34:f2:12:5f:2b:6c:8a:7d:8e:f0:1b:ca:1a:cb:f7&quot;;</span><br><span class="line">  private static final String wap02fingerprint = &quot;2a:97:e4:7b:50:e2:8a:5c:38:ae:d4:bf:fa:8c:ee:01&quot;;</span><br><span class="line"></span><br><span class="line">  public void diskCheck() throws IOException &#123;</span><br><span class="line">    run(&quot;10.13.135.71&quot;, wap01fingerprint, df_command);</span><br><span class="line">    run(&quot;10.13.135.72&quot;, wap02fingerprint, df_command);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private void restartRecon() throws IOException &#123;</span><br><span class="line">    run(&quot;10.13.135.71&quot;, wap01fingerprint, recon_command);</span><br><span class="line">    run(&quot;10.13.135.72&quot;, wap02fingerprint, recon_command);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private void run(String host, String fingerprint, String command)</span><br><span class="line">      throws IOException &#123;</span><br><span class="line">    final SSHClient ssh = new SSHClient();</span><br><span class="line">    //ssh.loadKnownHosts();</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      ssh.addHostKeyVerifier(fingerprint);</span><br><span class="line"></span><br><span class="line">      ssh.connect(host);</span><br><span class="line">      ssh.authPassword(user, passwd);</span><br><span class="line">      final Session session = ssh.startSession();</span><br><span class="line">      try &#123;</span><br><span class="line">        final Command cmd = session.exec(command);</span><br><span class="line">        System.out.println(&quot;&lt;&lt;&quot; + host + &quot;&gt;&gt; -- &quot; + IOUtils.readFully(cmd.getInputStream())</span><br><span class="line">            .toString());</span><br><span class="line">        cmd.join(5, TimeUnit.SECONDS);</span><br><span class="line">        //System.out.println(&quot;\n** exit status: &quot; + cmd.getExitStatus());</span><br><span class="line">      &#125; finally &#123;</span><br><span class="line">        session.close();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">      ssh.disconnect();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public static void main(String... args) throws IOException &#123;</span><br><span class="line">    App app = new App();</span><br><span class="line">    app.diskCheck();</span><br><span class="line">    app.restartRecon();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="run-mvn-compile-package"><a href="#run-mvn-compile-package" class="headerlink" title="run: mvn compile package"></a>run: <code>mvn compile package</code></h3><h3 id="file-structure-as-below"><a href="#file-structure-as-below" class="headerlink" title="file structure as below:"></a>file structure as below:</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">├─main</span><br><span class="line">│  ├─java</span><br><span class="line">│  │  └─dh</span><br><span class="line">│  │          App.java</span><br><span class="line">│  │</span><br><span class="line">│  └─resources</span><br><span class="line">│          logback.xml</span><br><span class="line">│</span><br><span class="line">└─test</span><br><span class="line">    └─java</span><br><span class="line">        └─dh</span><br><span class="line">                AppTest.java</span><br></pre></td></tr></table></figure>

<h3 id="run-program-in-command-line-run-bat"><a href="#run-program-in-command-line-run-bat" class="headerlink" title="run program in command line run.bat"></a>run program in command line run.bat</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line">java -cp target/ssh-remote-1.0-SNAPSHOT.jar;C:/Users/HPUser/.m2/repository/ch/qos/logback/logback-core/0.9.29/logback-core-0.9.29.jar;C:/Users/HPUser/.m2/repository/ch/qos/logback/logback-classic/0.9.29/logback-classic-0.9.29.jar;C:/Users/HPUser/.m2/repository/net/schmizz/sshj/0.8.0/sshj-0.8.0.jar;C:/Users/HPUser/.m2/repository/org/slf4j/slf4j-api/1.6.1/slf4j-api-1.6.1.jar dh.App</span><br><span class="line">rem mvn exec:java -Dexec.mainClass=&quot;dh.App&quot;</span><br><span class="line">rem mvn exec:java -Dexec.mainClass=&quot;dh.App&quot; -Dexec.classpathScope=runtime</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%BF%97/">工作日志</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="as_sitesearch" value="l1z2g9.github.io">
  </form>
</div>


  

  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/AIX/">AIX</a><small>29</small></li>
  
    <li><a href="/tags/MySQL/">MySQL</a><small>2</small></li>
  
    <li><a href="/tags/Oracle/">Oracle</a><small>14</small></li>
  
    <li><a href="/tags/Problem-Solve/">Problem Solve</a><small>8</small></li>
  
    <li><a href="/tags/Raspberry-Pi/">Raspberry Pi</a><small>12</small></li>
  
    <li><a href="/tags/%E5%B7%A5%E4%BD%9C%E6%97%A5%E5%BF%97/">工作日志</a><small>68</small></li>
  
    <li><a href="/tags/%E6%97%A5%E5%B8%B8%E8%AE%B0%E5%BD%95/">日常记录</a><small>23</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2022 Forrest Wan
  
</div>
<div class="clearfix"></div></footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>


<script src="/js/jquery.imagesloaded.min.js"></script>


<script src="/js/gallery.js"></script>





</body>
</html>
